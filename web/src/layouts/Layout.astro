---
import { initI18n, type Pages } from "../lib/i18n/index";

import "../styles/global.css";
import "../lib/strings";

import { Seo } from "astro-seo-meta";
import Button from "../components/Button.astro";
import { cn } from "../lib/utils";
import { Menu } from "lucide-react";

interface Props {
    className?: string;
    page: Pages;
    title?: string;
    description?: string;
    image?: string;
}

const { pathname } = Astro.url;
const { locale = "fr" } = Astro.params;
const { className, page, title, description, image } = Astro.props;

const { t } = initI18n(Astro.params);
const localizedPath = (currentLocale: string) => {
    const newLocale = currentLocale === "fr" ? "en" : "fr";
    return pathname.replace(currentLocale, newLocale);
};
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="manifest" type="application/json" href="/manifest.json" />
        <meta name="generator" content={Astro.generator} />

        <Seo
            title={t(($) => $.global.title, { title: title || t(($) => $[page].title) })}
            description={description || t(($) => $[page].description)}
            facebook={{
                image: new URL(image || t(($) => $.global.image), "https://unimat45.github.io/").toString(),
                url: "https://unimat45.github.io/",
                type: "website",
            }}
            twitter={{
                image: new URL(image || t(($) => $.global.image), "https://unimat45.github.io/").toString(),
                site: "https://unimat45.github.io/",
                card: "summary",
            }}
        />
    </head>
    <body
        class="grid min-h-screen grid-rows-[auto_1fr_auto] bg-linear-to-br from-gray-900 via-black to-gray-900 text-gray-300"
    >
        <header class="border-b border-cyan-500/20 bg-black/90 p-4 backdrop-blur-md z-20">
            <nav class="mx-auto max-w-7xl">
                <ul class="flex gap-2">
                    <li id="drop-down-btn" class="flex justify-center items-center sm:hidden">
                        <Menu />
                    </li>
                    <li class="hidden sm:block">
                        <a href={`/${locale}/`}>
                            <Button highlighted={page === "index"}> {t(($) => $.index.title)} </Button>
                        </a>
                    </li>
                    <li class="hidden sm:block">
                        <a href={`/${locale}/projects`}>
                            <Button highlighted={page === "projects"}> {t(($) => $.projects.title)} </Button>
                        </a>
                    </li>
                    <li class="hidden sm:block">
                        <a href={`/${locale}/contact`}>
                            <Button highlighted={page === "contact"}> {t(($) => $.contact.title)} </Button>
                        </a>
                    </li>
                    <li class="ml-auto">
                        <a href={localizedPath(locale)}>
                            <Button>{locale === "fr" ? "English" : "Fran√ßais"}</Button>
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <div
            id="drop-down"
            class="absolute -top-full left-0 right-0 sm:hidden z-10 border-b border-cyan-500/20 bg-black/90 p-4 backdrop-blur-md transition-[top] duration-300 ease-in-out"
        >
            <ul class="flex flex-col gap-2">
                <li>
                    <a href={`/${locale}/`}>
                        <Button className="text-lg" highlighted={page === "index"}> {t(($) => $.index.title)} </Button>
                    </a>
                </li>
                <li>
                    <a href={`/${locale}/projects`}>
                        <Button className="text-lg" highlighted={page === "projects"}>
                            {t(($) => $.projects.title)}
                        </Button>
                    </a>
                </li>
                <li>
                    <a href={`/${locale}/contact`}>
                        <Button className="text-lg" highlighted={page === "contact"}>
                            {t(($) => $.contact.title)}
                        </Button>
                    </a>
                </li>
            </ul>
        </div>

        <main class={cn("p-4 max-w-7xl mx-auto my-8", className)}>
            <slot />
        </main>
    </body>
</html>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // eslint-disable-next-line prettier/prettier
        const btn = document.getElementById("drop-down-btn");
        const dd = document.getElementById("drop-down");

        if (dd && btn) {
            btn.addEventListener("click", () => {
                dd.classList.toggle("drop-down");
            });
        }
    });
</script>
